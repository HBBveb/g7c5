<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>班级资源库｜认证访问</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 新增导航样式 */
        .nav-tabs {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            background: var(--dark-color);
        }
        
        .nav-button {
            padding: 0.8rem 1.5rem;
            border: none;
            background: none;
            color: white;
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .nav-button.active {
            background: var(--primary-color);
        }

        /* 分页样式 */
        .pagination {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            padding: 2rem;
        }

        .page-item {
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            border-radius: var(--radius-sm);
            cursor: pointer;
        }

        .page-item.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
    </style>
</head>
<body>
    <div class="auth-container">
        <!-- 保持原有认证界面不变 -->
    </div>

    <div id="contentContainer" style="display:none;">
        <!-- 新增导航 -->
        <nav class="nav-tabs">
            <button class="nav-button active" onclick="switchTab('videos')">
                <i class="fas fa-video"></i> 视频区
            </button>
            <button class="nav-button" onclick="switchTab('blogs')">
                <i class="fas fa-blog"></i> 博客区
            </button>
        </nav>

        <!-- 视频区 -->
        <div id="videoSection">
            <div class="video-grid" id="videoGrid"></div>
            <div class="pagination" id="videoPagination"></div>
        </div>

        <!-- 博客区 -->
        <div id="blogSection" style="display:none;">
            <div class="blog-grid" id="blogGrid"></div>
            <div class="pagination" id="blogPagination"></div>
        </div>
    </div>

    <!-- 新增博客内容容器 -->
    <div class="modal" id="blogModal">
        <div class="modal-content" style="max-width:800px;padding:2rem;">
            <div id="blogContent"></div>
            <button onclick="closeBlog()" class="auth-button">
                <i class="fas fa-times"></i> 关闭
            </button>
        </div>
    </div>

    <script>
        // 新增配置
        const config = {
            videosPerPage: 4,
            blogsPerPage: 3,
            currentVideoPage: 1,
            currentBlogPage: 1,
            activeTab: 'videos'
        };

        // 修改后的加载函数
        async function loadVideos() {
            const response = await fetch('videos.json');
            const allVideos = await response.json();
            const paginated = paginate(allVideos, config.currentVideoPage, config.videosPerPage);
            
            renderVideos(paginated.data);
            renderPagination('videoPagination', allVideos.length, config.videosPerPage, config.currentVideoPage, 'video');
        }

        // 新增博客加载函数
        async function loadBlogs() {
            const response = await fetch('blogs.json');
            const allBlogs = await response.json();
            const paginated = paginate(allBlogs, config.currentBlogPage, config.blogsPerPage);
            
            renderBlogs(paginated.data);
            renderPagination('blogPagination', allBlogs.length, config.blogsPerPage, config.currentBlogPage, 'blog');
        }

        // 分页逻辑
        function paginate(items, currentPage, perPage) {
            const start = (currentPage - 1) * perPage;
            const end = start + perPage;
            return {
                data: items.slice(start, end),
                total: items.length
            };
        }

        // 分页渲染
        function renderPagination(containerId, totalItems, perPage, currentPage, type) {
            const totalPages = Math.ceil(totalItems / perPage);
            const container = document.getElementById(containerId);
            
            let html = `
                <button class="page-item" onclick="changePage(${currentPage - 1}, '${type}')" 
                    ${currentPage === 1 ? 'disabled' : ''}>«</button>`;

            for (let i = 1; i <= totalPages; i++) {
                html += `<button class="page-item ${i === currentPage ? 'active' : ''}" 
                         onclick="changePage(${i}, '${type}')">${i}</button>`;
            }

            html += `
                <button class="page-item" onclick="changePage(${currentPage + 1}, '${type}')" 
                    ${currentPage === totalPages ? 'disabled' : ''}>»</button>`;

            container.innerHTML = html;
        }

        // 新增博客渲染函数
        function renderBlogs(blogs) {
            const grid = document.getElementById('blogGrid');
            grid.innerHTML = blogs.map(blog => `
                <div class="video-card">
                    <div class="video-thumbnail" onclick="loadBlogContent('${blog.name}')">
                        <i class="fas fa-file-alt fa-3x" style="color:#666;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)"></i>
                    </div>
                    <div class="video-info">
                        <h3>${blog.name.replace('.html', '')}</h3>
                        <button onclick="loadBlogContent('${blog.name}')" class="auth-button">
                            <i class="fas fa-book-open"></i> 阅读全文
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // 新增博客内容加载
        async function loadBlogContent(filename) {
            try {
                const response = await fetch(filename);
                const content = await response.text();
                document.getElementById('blogContent').innerHTML = content;
                document.getElementById('blogModal').style.display = 'flex';
            } catch {
                alert('博客内容加载失败');
            }
        }

        // 新增切换标签功能
        function switchTab(tab) {
            config.activeTab = tab;
            document.querySelectorAll('.nav-button').forEach(btn => 
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(tab))
            );
            
            document.getElementById('videoSection').style.display = 
                tab === 'videos' ? 'block' : 'none';
            document.getElementById('blogSection').style.display = 
                tab === 'blogs' ? 'block' : 'none';

            if(tab === 'videos') loadVideos();
            if(tab === 'blogs') loadBlogs();
        }

        // 新增分页控制
        function changePage(page, type) {
            if(type === 'video') {
                config.currentVideoPage = page;
                loadVideos();
            } else {
                config.currentBlogPage = page;
                loadBlogs();
            }
        }

        // 修改后的认证通过逻辑
        function checkAuth() {
            if(document.getElementById('authCode').value === AUTH_CODE) {
                document.getElementById('contentContainer').style.display = 'block';
                loadVideos(); // 默认加载视频
            }
        }

        // 关闭博客弹窗
        function closeBlog() {
            document.getElementById('blogModal').style.display = 'none';
        }
    </script>
</body>
</html>
